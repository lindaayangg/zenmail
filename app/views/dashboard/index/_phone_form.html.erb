<% if current_user.phone_number.present? && current_user.is_phone_number_verified %>
  <div class="form-control">
    <div class="flex gap-2 items-center text-sm md:text-base">
      <span class="font-semibold">Phone Number:</span>
      <span class="text-base-content/80"><%= current_user.formatted_phone_number %></span>
    </div>
    <div class="form-control mt-4">
      <%= form_with url: dashboard_send_get_started_text_path, method: :post do |form| %>
        <%= form.submit "Send Text", class: "btn btn-primary w-full text-sm" %>
      <% end %>
    </div>
  </div>
<% elsif current_user.phone_number_verification_code.present? && !current_user.is_phone_number_verified %>
  <%= form_with url: dashboard_verify_phone_code_path, method: :post do |form| %>
    <div class="form-control">
      <fieldset class="fieldset">
        <legend class="fieldset-legend text-sm">Enter Verification Code</legend>
        <%= form.text_field :verification_code, class: "input input-md input-bordered w-full", placeholder: "Enter code", autocomplete: "one-time-code", inputmode: "numeric", pattern: "\\d*", maxlength: 6, data: { controller: "verification-code", action: "input->verification-code#format keypress->verification-code#preventNonNumeric paste->verification-code#format" } %>
      </fieldset>
      <div class="form-control mt-4">
        <%= form.submit "Verify Code", class: "btn btn-primary w-full text-sm" %>
      </div>
    </div>
  <% end %>
<% else %>
  <%= form_with url: dashboard_send_verify_text_path, method: :post do |form| %>
    <div class="form-control">
      <fieldset class="fieldset">
        <legend class="fieldset-legend text-sm">Phone Number</legend>
        <div class="flex gap-2">
          <%= form.select :phone_country_code, 
              [['+1 (US)', 'US'], ['+1 (CA)', 'CA']], 
              { selected: params[:phone_country_code].presence || 'US' },
              { class: "select select-bordered w-24 h-full" } %>
          <%= form.telephone_field :phone_number, 
              class: "input input-md input-bordered flex-1 w-full", 
              placeholder: "(123) 456-7890",
              inputmode: "numeric",
              autocomplete: "tel",
              value: params[:phone_number],
              data: { 
                controller: "phone-input",
                action: "input->phone-input#format keypress->phone-input#preventNonNumeric paste->phone-input#format"
              } %>
        </div>
      </fieldset>
      <div class="form-control mt-4">
        <%= form.submit "Send Verification Code", class: "btn btn-primary w-full text-sm" %>
      </div>
    </div>
  <% end %>
<% end %> 